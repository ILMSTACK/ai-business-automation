{% extends "base.html" %}
{% block content %}
<style>
#out { white-space: pre-wrap; border: 1px solid #ddd; padding: 8px; min-height: 160px; }
</style>

<div>
  <label>Model</label>
  <input id="model" value="{{ config.OLLAMA_MODEL if config and config.OLLAMA_MODEL else 'qwen2.5:7b' }}" />
</div>
<div>
  <label>Prompt</label>
  <textarea id="prompt" rows="4" style="width:100%">Explain Flask blueprints in 3 bullets</textarea>
</div>
<button id="send">Send (stream)</button>

<h3>Output</h3>
<div id="out"></div>

<script>
const btn = document.getElementById('send');
const out = document.getElementById('out');
btn.onclick = async () => {
  out.textContent = '';
  const model = document.getElementById('model').value || '';
  const prompt = document.getElementById('prompt').value || '';
  const resp = await fetch('/api/llm/chat/stream', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ prompt, model })
  });
  const reader = resp.body.getReader();
  const dec = new TextDecoder();
  while (true) {
    const { value, done } = await reader.read();
    if (done) break;
    out.textContent += dec.decode(value, { stream: true });
  }
};
</script>
{% endblock %}
